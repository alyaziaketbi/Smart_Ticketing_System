@page
@model SmartTicketingManagementApp.Pages.Support.IndexModel
@{
}

<h2>@(Model.TeamName ?? "Support") Dashboard</h2>
<p>Welcome @Model.UserName! You can resolve tickets assigned to you.</p>

<div class="row g-3 mb-4">
    <div class="col">
        <div class="card shadow-sm stat-card p-3">
            <div class="card-body py-3">
                <h6 class="stat-title mb-1">Total Assigned</h6>
                <h4 class="stat-value mb-0">@Model.TotalAssigned</h4>
            </div>
        </div>
    </div>
    <div class="col">
        <div class="card shadow-sm stat-card p-3">
            <div class="card-body py-3">
                <h6 class="stat-title mb-1">New</h6>
                <h4 class="stat-value mb-0">@Model.NewTickets</h4>
            </div>
        </div>
    </div>
    <div class="col">
        <div class="card shadow-sm stat-card p-3">
            <div class="card-body py-3">
                <h6 class="stat-title mb-1">In Progress</h6>
                <h4 class="stat-value mb-0">@Model.InProgressTickets</h4>
            </div>
        </div>
    </div>
    <div class="col">
        <div class="card shadow-sm stat-card p-3">
            <div class="card-body py-3">
                <h6 class="stat-title mb-1">Resolved</h6>
                <h4 class="stat-value mb-0">@Model.ResolvedTickets</h4>
            </div>
        </div>
    </div>
    <div class="col">
        <div class="card shadow-sm stat-card p-3">
            <div class="card-body py-3">
                <h6 class="stat-title mb-1">Canceled</h6>
                <h4 class="stat-value mb-0">@Model.CanceledTickets</h4>
            </div>
        </div>
    </div>
</div>


<div class="card shadow-sm border-0 rounded-4 p-3 bg-white mb-4">
    <h6 class="fw-semibold mb-3">Team Information</h6>
    <dl class="row mb-0">
        <dt class="col-sm-3">Team Name</dt>
        <dd class="col-sm-9">@Model.TeamName</dd>

        <dt class="col-sm-3">Description</dt>
        <dd class="col-sm-9">@Model.TeamDescription</dd>
    </dl>
</div>

<div class="card shadow-sm border-0 rounded-4 p-3 bg-white mt-3">

<form method="get" class="mb-3">
    <div class="btn-group" role="group" aria-label="Status Filter">
        <input type="hidden" name="page" value="1" />

        <button type="submit" name="status" value="All"
                class="btn @(string.IsNullOrEmpty(Model.Status) || Model.Status == "All" ? "btn-dark active" : "btn-outline-dark")">
            All
        </button>

        <button type="submit" name="status" value="Assigned"
                class="btn @(Model.Status == "Assigned" ? "btn-dark active" : "btn-outline-dark")">
            Assigned
        </button>

        <button type="submit" name="status" value="InProgress"
                class="btn @(Model.Status == "InProgress" ? "btn-dark active" : "btn-outline-dark")">
            In Progress
        </button>

        <button type="submit" name="status" value="Resolved"
                class="btn @(Model.Status == "Resolved" ? "btn-dark active" : "btn-outline-dark")">
            Resolved
        </button>

        <button type="submit" name="status" value="Canceled"
                class="btn @(Model.Status == "Canceled" ? "btn-dark active" : "btn-outline-dark")">
            Cancelled
        </button>
    </div>
</form>

@if (Model.Items.Count == 0)
{
    <div class="alert alert-light border mt-3">No tickets assigned to your team.</div>
}
else
{
 
        <h6 class="fw-semibold mb-3">Team Tickets</h6>

        <div class="table-responsive">
            <table class="table align-middle mb-0">
                <thead class="border-bottom">
                    <tr>
                        <th>ID</th>
                        <th>Title</th>
                        <th>User</th>
                        <th>Status</th>
                        <th>Priority</th>
                        <th>Created</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var t in Model.Items)
                    {
                        <tr>
                            <td><code>ticket-@t.Id</code></td>
                            <td>@t.Subject</td>
                            <td>@t.UserName</td>
                            <td>
                                @if (string.IsNullOrWhiteSpace(t.Status))
                                {
                                    <span>—</span>
                                }
                                else
                                {
                                    <span class="badge status-badge @(t.Status.ToLower().Replace("_", "-"))">@t.Status.ToLower()</span>
                                }
                            </td>
                            <td>
                                @if (string.IsNullOrWhiteSpace(t.Priority))
                                {
                                    <span>—</span>
                                }
                                else
                                {
                                    <span class="badge priority-badge @t.Priority.ToLower()">@t.Priority</span>
                                }
                            </td>
                            <td>@(t.CreatedAt?.ToString("MMM dd, yyyy") ?? "—")</td>
                            <td>
                                <a asp-page="./Index" asp-route-viewId="@t.Id" class="view-link text-dark text-decoration-none">
                                    <i class="bi bi-eye"></i> View
                                </a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
}
</div>

@if (Model.SelectedTicket != null)
{
    var t = Model.SelectedTicket;
    <div class="modal-backdrop-custom"></div>
    <div class="modal show d-block" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5>@t.subject</h5>
                    <a asp-page="./Index" class="btn-close"></a>
                </div>
                <div class="modal-body">
                    <div class="d-flex align-items-center mb-3">
                        <span class="badge status-badge @(t.status?.ToLower().Replace("_", "-")) me-2">
                            @t.status
                        </span>
                        @if (!string.IsNullOrEmpty(t.priority))
                        {
                            <span class="badge priority-badge @(t.priority.ToLower())">
                                @t.priority
                            </span>
                        }
                    </div>

                    <!-- Info Box -->
                    <div class="p-3 rounded-3 mb-3" style="background-color:#f8f9fa;">
                        <div class="row">
                            <div class="col-6 d-flex align-items-center">
                                <i class="bi bi-person me-2 text-secondary"></i>
                                <div>
                                    <small class="text-muted d-block">Submitted by</small>
                                    <strong>@(string.IsNullOrWhiteSpace(t.requester?.name) ? "—" : t.requester.name)</strong>

                                </div>
                            </div>
                            <div class="col-6 d-flex align-items-center">
                                <i class="bi bi-clock me-2 text-secondary"></i>
                                <div>
                                    <small class="text-muted d-block">Created</small>
                                    <strong>@(t.created_at?.ToString("MMM dd, yyyy, hh:mm tt"))</strong>
                                </div>
                            </div>
                            <div class="col-12 mt-2 d-flex align-items-center">
                                <i class="bi bi-diagram-3 me-2 text-secondary"></i>
                                <div>
                                    <small class="text-muted d-block">Assigned to</small>
                                    <strong>@t.assigned_team?.team_name</strong>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h6 class="fw-semibold">Description</h6>
                    <p class="text-muted">@t.body</p>

                    @if (t.status?.ToUpper() == "RESOLVED")
                    {
                        <div id="resolutionBox" class="p-3 rounded-3"
                             style="background-color:#eaf7ea; border-left:4px solid #28a745;">
                            <h6 class="fw-semibold text-success mb-1">
                                <i class="bi bi-check-circle"></i> Resolved
                            </h6>
                            <p class="text-muted mb-1">
                                Resolved by @t.assigned_team?.team_name 
                            </p>
                            <p class="mb-0"><strong>Resolution comments:</strong> @t.answer</p>
                        </div>
                    }

                    @if (t.status?.ToUpper() == "CANCELED")
                    {
                        <div id="canceledBox" class="p-3 rounded-3 mt-2"
                             style="background-color:#fdeaea; border-left:4px solid #dc3545;">
                            <h6 class="fw-semibold text-danger mb-1">
                                <i class="bi bi-exclamation-circle"></i> Status
                            </h6>
                            <p class="text-danger mb-1">
                                This ticket has been cancelled by @(string.IsNullOrWhiteSpace(t.assigned_team?.team_name)).
                            </p>
                            <p class="mb-0">
                                <strong>Cancelled reason:</strong> @(!string.IsNullOrWhiteSpace(t.answer) ? t.answer : "No reason provided.")
                            </p>
                        </div>
                    }

                    @if (t.status?.ToUpper() == "ASSIGNED")
                    {
                        <div id="assignedBox" class="p-3 rounded-3 mt-3"
                             style="background-color:#e7f1ff; border-left:4px solid #0d6efd;">
                            <h6 class="fw-semibold text-primary mb-2">
                                <i class="bi bi-info-circle"></i> Start Working on Ticket
                            </h6>
                            <p class="text-muted mb-3">
                                This ticket has been assigned to your team. Click the button below to start working on it.
                            </p>
                            <div class="d-flex justify-content-center">
                                <button type="button" class="btn btn-dark fw-semibold text-white px-4 py-2"
                                        style="min-width: 320px;" onclick="startWork(@t.ticket_id)">
                                    <i class="bi bi-play-circle me-2"></i> Start Working (Move to In Progress)
                                </button>
                            </div>
                        </div>
                    }

                    @if (t.status?.ToUpper() == "INPROGRESS")
                    {
                        <div id="inProgressBox" class="p-3 rounded-3 mt-3"
                             style="background-color:#e7f1ff; border-left:4px solid #0d6efd;">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6 class="fw-semibold text-dark mb-0">Update Ticket</h6>
                                <div class="d-flex gap-2">
                                    <button type="button" class="btn btn-light text-dark fw-semibold btn-find-similar"
                                            data-ticket-id="@Model.SelectedTicket.ticket_id">
                                        <i class="bi bi-search me-1"></i> Find Similar
                                    </button>
                                    <button id="suggestSolutionBtn" type="button" class="btn btn-light text-dark fw-semibold"
                                        data-ticket-id="@Model.SelectedTicket.ticket_id">
                                        <i class="bi bi-stars me-1"></i> Suggest Solution
                                    </button>
                                </div>
                            </div>

                            <!-- Suggested Solution BOX (initially hidden) -->
                            <div id="suggestedSolutionBox" class="p-3 rounded-3 mb-3"
                                 style="background-color:#eaf7ea; border-left:4px solid #28a745; display:none;">
                                <h6 class="fw-semibold text-success mb-2">
                                    <i class="bi bi-stars"></i> Suggested Solution
                                </h6>
                                <p id="suggestedText" class="mb-3 text-muted"></p>
                                <div class="d-flex gap-2">
                                    <button type="button" id="useSolutionBtn" class="btn btn-light  fw-semibold">
                                        <i class="bi bi-check-circle"></i> Use This Solution
                                    </button>
                                    <button type="button" id="dismissSolutionBtn" class="btn btn-light border">
                                        Dismiss
                                    </button>
                                </div>
                            </div>



                            <div class="mt-3">
                                <textarea id="updateDetails" class="form-control" rows="3" placeholder="Add resolution or cancellation details..."></textarea>

                                <div class="d-flex align-items-center gap-2 mt-2">
                                    <select id="statusDropdown" class="form-select" style="width:auto;">
                                        <option value="">Change status</option>
                                        <option value="Resolved">Resolved</option>
                                        <option value="Canceled">Canceled</option>
                                    </select>

                                    <button type="button" id="postUpdateBtn" class="btn btn-light text-dark fw-semibold" data-ticket-id="@t.ticket_id">
                                        Post Update
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Separate Similar Tickets Tab -->
                        <div id="similarTab" class="p-3 rounded-3 mt-3"
                             style="background-color:#f8f9fa; border-left:4px solid #0d6efd; display:none;">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6 class="fw-semibold text-primary mb-0">
                                    <i class="bi bi-search"></i> Similar Resolved Tickets
                                    <span class="badge bg-primary ms-2">Top 5</span>
                                </h6>
                                <button id="closeSimilarTab" class="btn btn-outline-secondary btn-sm fw-semibold">
                                    <i class="bi bi-x-lg"></i> Close
                                </button>
                            </div>
                            <div id="similarResults" class="d-flex flex-column gap-3"></div>
                        </div>

                    }


                </div>
            </div>
        </div>
    </div>
}


<nav aria-label="Page navigation" class="mt-3">
    <ul class="pagination">
        <li class="page-item @(Model.Page <= 1 ? "disabled" : "")">
            <a class="page-link" href="?status=@Model.Status&page=@(Model.Page - 1)&pageSize=@Model.PageSize">Prev</a>
        </li>
        <li class="page-item disabled">
            <span class="page-link">Page @Model.Page of @Model.TotalPages</span>
        </li>
        <li class="page-item @(Model.Page >= Model.TotalPages ? "disabled" : "")">
            <a class="page-link" href="?status=@Model.Status&page=@(Model.Page + 1)&pageSize=@Model.PageSize">Next</a>
        </li>
    </ul>
</nav>





<style>
    /* ====== Page background ====== */
    body {
        background-color: #f8f9fa; /* light grey */
    }

    .modal-backdrop-custom {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background-color: rgba(0, 0, 0, 0.4); /* <-- adjust 0.4 for darker/lighter */
        z-index: 1040;
    }

    /* ====== Card styling ====== */
    .card {
        background-color: #fff;
        border-radius: 1rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        padding: 1rem 1.5rem;
        transition: transform 0.15s ease;
    }

        .card:hover {
            transform: translateY(-2px);
        }

        .card h6 {
            color: #333;
        }

    /* ====== Table styling ====== */
    .table {
        border-collapse: separate;
        border-spacing: 0 2px;
    }

        .table tbody tr:hover {
            background-color: #f1f3f5; /* subtle grey hover */
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

    /* ====== Button styling ====== */
    .view-btn {
        text-decoration: none !important;
        background: none;
        box-shadow: none;
        color: #212529;
    }

        .view-btn:hover {
            color: #0d6efd; /* blue hover */
        }

        .view-btn i {
            font-size: 1.1rem;
        }

    /* ====== Badge styling ====== */
    .badge {
        font-weight: 600;
        font-size: 0.8rem;
        padding: 0.4em 0.75em;
        border-radius: 0.5rem;
        text-transform: capitalize;
    }

    /* ===== PRIORITY COLORS ===== */
    .priority-badge.high {
        background-color: #dc3545; /* red */
        color: white;
    }

    .priority-badge.medium {
        background-color: #ffc107; /* yellow */
        color: #212529;
    }

    .priority-badge.low {
        background-color: #0d6efd; /* blue */
        color: white;
    }

    /* ===== STATUS COLORS ===== */
    .status-badge.open {
        background-color: #0d6efd;
        color: white;
    }

    .status-badge.assigned {
        background-color: #6c757d;
        color: white;
    }

    .status-badge.inprogress {
        background-color: #d63384;
        color: white;
    }

    .status-badge.resolved {
        background-color: #198754;
        color: white;
    }

    .status-badge.canceled {
        background-color: #dc3545;
        color: white;
    }

    .status-badge.closed {
        background-color: #6c757d;
        color: white;
    }

    /* ===== Misc ===== */
    .bg-light {
        background-color: #f8f9fa !important;
    }

    .fw-semibold {
        color: #212529;
    }

    .nowrap {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 150px;
    }

    /* ===== Filter buttons (New, In Progress, Resolved, All) ===== */
    .filter-tabs {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1rem;
    }

    .filter-btn {
        border: 1px solid #dee2e6;
        background: white;
        padding: 0.4rem 0.8rem;
        border-radius: 0.5rem;
        font-weight: 500;
        color: #495057;
        transition: all 0.15s ease;
    }

        .filter-btn.active,
        .filter-btn:hover {
            background-color: #0d6efd;
            color: white;
            border-color: #0d6efd;
        }

    .btn-group .btn {
        border-radius: 20px !important;
        padding: 0.35rem 1rem;
        font-weight: 500;
    }

        .btn-group .btn + .btn {
            margin-left: 4px;
        }

    .btn-outline-dark.active,
    .btn-dark.active {
        background-color: #212529 !important;
        color: #fff !important;
    }

    .btn-dark.text-white {
        color: #fff !important;
    }

        .btn-dark.text-white:hover,
        .btn-dark.text-white:focus,
        .btn-dark.text-white:active {
            color: #fff !important;
            background-color: #000 !important;
            #inProgressBox .btn-outline-dark

    {
        font-weight: 500;
        border-radius: 0.5rem;
        transition: all 0.2s ease;
    }

    #inProgressBox .btn-outline-dark:hover {
        background-color: #000;
        color: #fff;
    }

    #inProgressBox textarea {
        resize: none;
    }

    #inProgressBox select,
    #inProgressBox textarea,
    #inProgressBox button {
        border-radius: 0.5rem;
    }

    #inProgressBox {
        border-radius: 0.75rem;
    }

        #inProgressBox textarea {
            resize: none;
            border-radius: 0.5rem;
        }

        #inProgressBox select,
        #inProgressBox button {
            border-radius: 0.5rem;
        }

        /* Find Similar + Suggest Solution (white buttons) */
        #inProgressBox .btn-light {
            background-color: #fff;
            border: 1px solid #ccc;
            transition: all 0.2s ease;
        }

</style>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // ✅ ELEMENTS
            const suggestBtn = document.getElementById('suggestSolutionBtn');
            const suggestionBox = document.getElementById('suggestedSolutionBox');
            const suggestedText = document.getElementById('suggestedText');
            const dismissBtn = document.getElementById('dismissSolutionBtn');
            const useBtn = document.getElementById('useSolutionBtn');
            const detailsBox = document.getElementById('updateDetails');
            const statusDropdown = document.getElementById('statusDropdown');
            const postBtn = document.getElementById('postUpdateBtn');

            // ✅ Suggest Solution
            if (suggestBtn) {
                suggestBtn.addEventListener('click', async () => {
                    const ticketId = suggestBtn.dataset.ticketId;
                    console.log("🧠 Suggest Solution clicked for Ticket:", ticketId);

                    suggestBtn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Loading...';
                    suggestBtn.disabled = true;

                    try {
                        const res = await fetch(`?handler=SuggestSolution`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]')?.value || ''
                            },
                            body: JSON.stringify({ ticketId: parseInt(ticketId) })
                        });

                        console.log("📡 Response status:", res.status);

                        if (!res.ok) {
                            throw new Error(`Server responded with ${res.status}`);
                        }

                        const data = await res.json();
                        console.log("📦 Response JSON:", data);

                        if (data.success) {
                            suggestedText.textContent = data.solution;
                            suggestionBox.style.display = 'block';
                        } else {
                            suggestedText.textContent = "No solution found.";
                            suggestionBox.style.display = 'block';
                        }

                    } catch (err) {
                        console.error("❌ Fetch error:", err);
                        suggestedText.textContent = "Error fetching solution.";
                        suggestionBox.style.display = 'block';
                    } finally {
                        suggestBtn.innerHTML = '<i class="bi bi-stars me-1"></i> Suggest Solution';
                        suggestBtn.disabled = false;
                    }
                });
            }

            // ✅ Dismiss
            dismissBtn?.addEventListener('click', () => {
                suggestionBox.style.display = 'none';
            });

            // ✅ Use Solution
            useBtn?.addEventListener('click', () => {
                detailsBox.value = suggestedText.textContent.trim();
                if (statusDropdown) statusDropdown.value = 'Resolved';
                suggestionBox.style.display = 'none';
                showToast("✅ Solution applied successfully");
            });

            // ✅ Post Update
            if (postBtn) {
                postBtn.addEventListener("click", async () => {
                    const ticketId = postBtn.dataset.ticketId;
                    const details = document.getElementById("updateDetails").value.trim();
                    const newStatus = document.getElementById("statusDropdown").value;

                    if (!ticketId || !newStatus) {
                        alert("Please select a status before posting the update.");
                        return;
                    }

                    const payload = {
                        TicketId: parseInt(ticketId),
                        NewStatus: newStatus,
                        Answer: details
                    };

                    const res = await fetch("?handler=UpdateTicket", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(payload)
                    });

                    if (!res.ok) {
                        console.error("❌ Server returned", res.status);
                        alert("Update failed: " + res.status);
                        return;
                    }

                    const data = await res.json().catch(() => null);

                    if (data && data.success) {
                        showToast("✅ " + data.message);
                        setTimeout(() => window.location.reload(), 1000);
                    } else {
                        showToast("❌ " + (data?.message || "Unexpected error"), true);
                    }
                });
            }

            // ✅ Find Similar
                   const findBtn = document.querySelector('.btn-find-similar');
        const similarTab = document.getElementById('similarTab');
        const similarResults = document.getElementById('similarResults');
        const closeSimilarBtn = document.getElementById('closeSimilarTab');
        const inProgressBox = document.getElementById('inProgressBox');

        if (findBtn) {
            findBtn.addEventListener('click', async () => {
                const ticketId = findBtn.dataset.ticketId;
                findBtn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Loading...';
                findBtn.disabled = true;

                try {
                    const res = await fetch(`?handler=FindSimilar`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ ticketId: parseInt(ticketId) })
                    });

                    const data = await res.json();
                    console.log('🧩 Similar Response:', data);

                    if (data.success && data.results?.length) {
                        similarResults.innerHTML = data.results.map((r, i) => `
                            <div class="card shadow-sm border-0 rounded-3">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <h6 class="text-primary mb-0">#${i + 1} <span class="text-muted small">ID: ${r.ticket_id}</span></h6>
                                        <span class="badge bg-success">${r.assigned_team_name || '—'}</span>
                                    </div>
                                    <h5 class="fw-semibold mb-1">${r.title}</h5>
                                    <p class="text-muted mb-2"><strong>Description:</strong> ${r.description || "—"}</p>
                                    <div class="p-2 rounded-3" style="background-color:#eaf7ea; border-left:4px solid #28a745;">
                                        <p class="text-success fw-semibold mb-1">Resolution</p>
                                        <p class="mb-0">${r.answer || "No resolution available."}</p>
                                    </div>
                                </div>
                            </div>
                        `).join('');
                    } else {
                        similarResults.innerHTML = `<div class="text-muted text-center py-2">No similar tickets found.</div>`;
                    }

                    // Toggle view
                    inProgressBox.style.display = 'none';
                    similarTab.style.display = 'block';

                } catch (err) {
                    console.error(err);
                    similarResults.innerHTML = `<div class="text-danger text-center py-2">Error fetching similar tickets.</div>`;
                    similarTab.style.display = 'block';
                } finally {
                    findBtn.innerHTML = '<i class="bi bi-search me-1"></i> Find Similar';
                    findBtn.disabled = false;
                }
            });
        }

        closeSimilarBtn?.addEventListener('click', () => {
            similarTab.style.display = 'none';
            inProgressBox.style.display = 'block';
        });


            // ✅ Start Work
            window.startWork = async function (ticketId) {
                console.log("▶ StartWork clicked:", ticketId);

                try {
                    const res = await fetch('?handler=StartWork', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ ticketId })
                    });

                    console.log("📡 Response status:", res.status);

                    if (!res.ok) {
                        showToast("❌ Server error: " + res.status, true);
                        return;
                    }

                    const data = await res.json();
                    console.log("✅ Response JSON:", data);

                    if (data.success) {
                        showToast("✅ Ticket moved to In Progress");
                        setTimeout(() => location.reload(), 800);
                    }
                } catch (err) {
                    console.error("⚠️ JS error:", err);
                    showToast("Error updating ticket", true);
                }
            };

            // ✅ Toast
            function showToast(message, isError = false) {
                const toast = document.createElement('div');
                toast.textContent = message;
                toast.style.position = 'fixed';
                toast.style.bottom = '20px';
                toast.style.right = '20px';
                toast.style.padding = '10px 16px';
                toast.style.borderRadius = '8px';
                toast.style.backgroundColor = isError ? '#f8d7da' : '#fff';
                toast.style.border = isError ? '1px solid #dc3545' : '1px solid #ddd';
                toast.style.boxShadow = '0 2px 10px rgba(0,0,0,0.1)';
                toast.style.zIndex = '9999';
                document.body.appendChild(toast);
                setTimeout(() => toast.remove(), 2500);
            }

        }); // ✅ END DOMContentLoaded
    </script>
}
